<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<style type="text/css">

/* Admonition */

.admonition {
    padding-left: 15px;
    padding-right: 15px;
    margin-bottom: 10px;
    border: 1px solid transparent;
    border-radius: 4px;
    text-align: left;
}

.admonition.note { /* csslint allow: adjoining-classes */
    color: black;
    background-color: #d9edf7;
    border-color: #bce8f1;
}

.admonition.quote { /* csslint allow: adjoining-classes */
    color: black;
    background-color: #cecece;
    border-color: #cccccc;
}

.admonition.warning { /* csslint allow: adjoining-classes */
    color: black;
    background-color: #FCC8BE;
    border-color: #FCC8BE;
}

.admonition.hint { /* csslint allow: adjoining-classes */
    color: black;
    background-color: #E9F9F6;
    border-color: #AFEEEE;
}

.admonition.danger { /* csslint allow: adjoining-classes */
    color: black;
    background-color: #F7B2A4;
    border-color: #F7B2A4;
}

.admonition-title {
    font-weight: bold;
    text-align: left;
}


/* Codehilite */

.hll { background-color: #ffffcc }
.c { color: #408080; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */
.k { color: #008000; font-weight: bold } /* Keyword */
.o { color: #666666 } /* Operator */
.ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.cm { color: #408080; font-style: italic } /* Comment.Multiline */
.cp { color: #BC7A00 } /* Comment.Preproc */
.cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.c1 { color: #408080; font-style: italic } /* Comment.Single */
.cs { color: #408080; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.gr { color: #FF0000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #00A000 } /* Generic.Inserted */
.go { color: #888888 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0044DD } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #7D9029 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #999999; font-weight: bold } /* Name.Entity */
.ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #A0A000 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mb { color: #666666 } /* Literal.Number.Bin */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sa { color: #BA2121 } /* Literal.String.Affix */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.dl { color: #BA2121 } /* Literal.String.Delimiter */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #BB6688 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.fm { color: #0000FF } /* Name.Function.Magic */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.vm { color: #19177C } /* Name.Variable.Magic */
.il { color: #666666 } /* Literal.Number.Integer.Long */

/* Estilo LPP */

body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  background-color: white;
  padding: 60px;
}

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px;
}

table {
  padding: 0;border-collapse: collapse; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

</style>

</head>

<body>
<h2>Semana 4</h2>
<p>Notas de clase de la semana 4 de LPP.</p>
<h2>Tema 2: Programación funcional</h2>
<h3>Veremos hoy</h3>
<ul>
<li>1 El paradigma de Programación Funcional</li>
<li>2 Scheme como lenguaje de programación funcional</li>
<li>3 Tipos de datos compuestos en Scheme</li>
<li>4 Listas en Scheme</li>
<li>5 <strong>Funciones como tipos de datos de primera clase</strong><ul>
<li>5.1 Forma especial <code>lambda</code></li>
<li>5.2 <strong>Funciones como argumentos de otras funciones</strong></li>
<li>5.3 <strong>Funciones que devuelven funciones</strong></li>
<li>5.4 <strong>Funciones en estructuras de datos</strong></li>
<li>5.5 <strong>Funciones de orden superior</strong></li>
</ul>
</li>
</ul>
<hr />
<h3>Ejemplo de uso de parámetros de tipo función para generalizar</h3>
<ul>
<li>
<p>La posibilidad de pasar funciones como parámetros de otras es una
  poderosa herramienta de abstracción. Veamos un ejemplo.</p>
</li>
<li>
<p>Supongamos que queremos calcular el sumatorio de <code>a</code> hasta
  <code>b</code>. ¿Cómo lo haríamos de forma recursiva?</p>
</li>
</ul>
<p style="margin-bottom:3cm;"></p>

<ul>
<li>
<p>Solución:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">sum-x</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span>
        <span class="mi">0</span>
        <span class="p">(</span><span class="nb">+</span> <span class="n">a</span> <span class="p">(</span><span class="n">sum-x</span> <span class="p">(</span><span class="nb">+</span> <span class="n">a</span> <span class="mi">1</span><span class="p">)</span> <span class="n">b</span><span class="p">))))</span>

<span class="p">(</span><span class="n">sum-x</span> <span class="mi">1</span> <span class="mi">10</span><span class="p">)</span> <span class="c1">; ⇒ 55</span>
</code></pre></div>
</li>
<li>
<p>Supongamos ahora que queremos calcular el sumatorio de <code>a</code> hasta <code>b</code>
  <strong>sumando los números al cuadrado</strong>. ¿Cómo lo haríamos?</p>
</li>
</ul>
<p style="margin-bottom:3cm;"></p>

<ul>
<li>
<p>Solución:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">sum-cuadrado-x</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span>
        <span class="mi">0</span>
        <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">*</span> <span class="n">a</span> <span class="n">a</span><span class="p">)</span> <span class="p">(</span><span class="n">sum-cuadrado-x</span> <span class="p">(</span><span class="nb">+</span> <span class="n">a</span> <span class="mi">1</span><span class="p">)</span> <span class="n">b</span><span class="p">))))</span>

<span class="p">(</span><span class="n">sum-cuadrado-x</span> <span class="mi">1</span> <span class="mi">10</span><span class="p">)</span> <span class="c1">; ⇒ 385</span>
</code></pre></div>
</li>
<li>
<p>¿Y el sumatorio de <code>a</code> hasta <code>b</code> <strong>sumando los cubos</strong>?</p>
</li>
</ul>
<p style="margin-bottom:3cm;"></p>

<ul>
<li>
<p>Solución:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">sum-cubo-x</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span>
        <span class="mi">0</span>
        <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">*</span> <span class="n">a</span> <span class="n">a</span> <span class="n">a</span><span class="p">)</span> <span class="p">(</span><span class="n">sum-cubo-x</span> <span class="p">(</span><span class="nb">+</span> <span class="n">a</span> <span class="mi">1</span><span class="p">)</span> <span class="n">b</span><span class="p">))))</span>

<span class="p">(</span><span class="n">sum-cubo-x</span> <span class="mi">1</span> <span class="mi">10</span><span class="p">)</span> <span class="c1">; ⇒ 3025</span>
</code></pre></div>
</li>
<li>
<p>El código de las tres funciones anteriores es muy similar.</p>
</li>
<li>Podemos generalizarlo definiendo una función que haga la recursión y
  que reciba como parámetro otra función que se aplica a los números.</li>
<li>
<p>Podemos definir una función genérica <code>sum-f-x</code> que generaliza las
  tres funciones anteriores: el sumatorio desde <code>a</code> hasta <code>b</code> de
  <code>f(x)</code>:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">sum-f-x</span> <span class="n">f</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span>
        <span class="mi">0</span>
        <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="n">f</span> <span class="n">a</span><span class="p">)</span> <span class="p">(</span><span class="n">sum-f-x</span> <span class="n">f</span> <span class="p">(</span><span class="nb">+</span> <span class="n">a</span> <span class="mi">1</span><span class="p">)</span> <span class="n">b</span><span class="p">))))</span>
</code></pre></div>
</li>
<li>
<p>Las funciones anteriores son casos particulares de esta función que
  las generaliza. Por ejemplo, para calcular el sumatorio desde 1
  hasta 10 de <code>x</code> al cubo:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">cubo</span> <span class="n">x</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">*</span> <span class="n">x</span> <span class="n">x</span> <span class="n">x</span><span class="p">))</span>

<span class="p">(</span><span class="n">sum-f-x</span> <span class="n">cubo</span> <span class="mi">1</span> <span class="mi">10</span><span class="p">)</span> <span class="c1">; ⇒ 3025</span>
</code></pre></div>
</li>
<li>
<p>O podemos sumar la expresión (n/(n-1)) para todos los números del 2
  al 100. Usamos una expresión lambda:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">sum-f-x</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">(</span><span class="nb">/</span> <span class="n">n</span> <span class="p">(</span><span class="nb">-</span> <span class="n">n</span> <span class="mi">1</span><span class="p">)))</span> <span class="mi">2</span> <span class="mi">100</span><span class="p">)</span>
</code></pre></div>
</li>
</ul>
<hr />
<h3>Funciones que devuelven funciones</h3>
<ul>
<li>Un objeto de primera clase puede ser devuelto por una función: es
  posible definir funciones que devuelvan otras funciones.</li>
<li>Característica fundamental del paradigma funcional, no presente en
  lenguajes que no son funcionales (como C, C++ o Java (antes de Java
  8)).</li>
<li>La función devuelta se crea en tiempo de ejecución, durante la
  invocación a la función principal.</li>
<li>La función devuelta se denomina <strong>clausura</strong> (<em>closure</em> en inglés).</li>
</ul>
<hr />
<h3>Ejemplo 1: función <code>sumador</code></h3>
<ul>
<li>
<p>Definimos una función constructora <code>(construye-sumador k)</code> que crea
  en su ejecución una función sumadora:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">construye-sumador</span> <span class="n">k</span><span class="p">)</span>
   <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">+</span> <span class="n">x</span> <span class="n">k</span><span class="p">)))</span>
</code></pre></div>
</li>
<li>
<p>La función constructora <code>construye-sumador</code> devuelve un procedimiento: </p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">construye-sumador</span> <span class="mi">10</span><span class="p">)</span> <span class="c1">; ⇒ #&lt;procedure&gt;</span>
</code></pre></div>
</li>
<li>
<p>Por ejemplo, si le pasamos 10, como parámetro devolverá una función
de un argumento que sumará 10 a ese argumento:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="n">f</span> <span class="p">(</span><span class="n">construye-sumador</span> <span class="mi">10</span><span class="p">))</span>
<span class="p">(</span><span class="n">f</span> <span class="mi">3</span><span class="p">)</span> <span class="c1">; ⇒ 13</span>
</code></pre></div>
</li>
<li>
<p>También:</p>
<div class="highlight"><pre><span></span><code><span class="p">((</span><span class="n">construye-sumador</span> <span class="mi">10</span><span class="p">)</span> <span class="mi">3</span><span class="p">)</span> <span class="c1">; ⇒ 13</span>
</code></pre></div>
</li>
<li>
<p>Dependiendo del parámetro que le pasemos a la función constructora
  obtendremos una función sumadora que sume un número u otro. Por
  ejemplo para obtener una función sumadora que suma 100:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="n">g</span> <span class="p">(</span><span class="n">construye-sumador</span> <span class="mi">100</span><span class="p">))</span>
<span class="p">(</span><span class="n">g</span> <span class="mi">3</span><span class="p">)</span> <span class="c1">; ⇒ 103</span>
</code></pre></div>
</li>
<li>
<p>¿Cómo funciona la clausura?</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="n">k</span> <span class="mi">10</span><span class="p">)</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">construye-sumador</span> <span class="n">k</span><span class="p">)</span>
   <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">+</span> <span class="n">x</span> <span class="n">k</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define</span> <span class="n">g</span> <span class="p">(</span><span class="n">construye-sumador</span> <span class="mi">100</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="n">f</span> <span class="p">(</span><span class="n">construye-sumador</span> <span class="mi">50</span><span class="p">))</span>
<span class="p">(</span><span class="n">g</span> <span class="mi">3</span><span class="p">)</span> <span class="c1">; ⇒ 103</span>
<span class="p">(</span><span class="n">f</span> <span class="mi">6</span><span class="p">)</span> <span class="c1">; ⇒ 56</span>
</code></pre></div>
</li>
<li>
<p>Cuando invocamos a <code>construye-sumador</code> con un valor concreto para
  <code>k</code> (por  ejemplo 100), queda vinculado el valor de 100 al parámetro
  <code>k</code> en el ámbito local de la función.</p>
</li>
<li>En este ámbito local la expresión lambda crea una función. Esta
  función creada en el ámbito local <strong>captura</strong> este ámbito local, con
  sus variables y sus valores (en este caso la variable <code>k</code> y su valor
  100).</li>
<li>
<p>Cuando se invoca a la función desde fuera (cuando llamamos a <code>g</code> en
  el ejemplo) se ejecuta el cuerpo de la función <code>(+ x k)</code> con <code>x</code>
  valiendo el parámetro (3) y el valor de <code>k</code> se obtiene del ámbito
  capturado (100).</p>
</li>
<li>
<p>La siguiente imagen muestra gráficamente cómo se evalúan estas
  expresiones y qué variables se crean en memoria. Se pueden ver
  también los distintos ámbitos locales creados en las distintas
  invocaciones a las funciones.</p>
</li>
</ul>
<p><img src="imagenes/clausuras.png" width="700px"></p>
<h3>Funciones en estructuras de datos</h3>
<ul>
<li>Vamos a ver ejemplos que muestran que las funciones cumplen la
última condición de los objetos de primera clase: podemos incluirlas
en estructuras de datos.</li>
</ul>
<hr />
<h3>Construcción de listas de funciones</h3>
<ul>
<li>
<p>Para construir una lista de funciones debemos llamar a <code>list</code> con
las funciones como parámetros</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">doble</span> <span class="n">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="n">x</span> <span class="n">x</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">cuadrado</span> <span class="n">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="n">x</span> <span class="n">x</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">suma-1</span> <span class="n">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="n">x</span> <span class="mi">1</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="n">lista</span> <span class="p">(</span><span class="nb">list</span> <span class="n">cuadrado</span> <span class="n">suma-1</span> <span class="n">doble</span><span class="p">))</span>
<span class="n">lista</span>
<span class="c1">; ⇒ (#&lt;procedure:cuadrado&gt;  #&lt;procedure:suma-1&gt;  #&lt;procedure:doble&gt;)</span>
</code></pre></div>
</li>
<li>
<p>También podemos usar expresiones <code>lambda</code> para crear la función que
  se incluye en la lista. Por ejemplo, podemos añadir una función que
  suma 5 a un número:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="n">lista2</span> <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="n">x</span> <span class="mi">5</span><span class="p">))</span> <span class="n">lista</span><span class="p">))</span>
<span class="n">lista2</span>
<span class="c1">; ⇒ (#&lt;procedure&gt; #&lt;procedure:cuadrado&gt; #&lt;procedure:suma-1&gt; #&lt;procedure:doble&gt;)</span>
</code></pre></div>
</li>
</ul>
<hr />
<h3>Invocación a funciones de una lista</h3>
<ul>
<li>Una vez creada una lista con funciones, ¿cómo podemos invocar a
  alguna de ellas?.</li>
<li>
<p>Debemos tratarlas de la misma forma que tratamos cualquier otro dato
  guardado en la lista, las recuperamos con las funciones <code>car</code> o
  <code>list-ref</code> y las invocamos.</p>
</li>
<li>
<p>Por ejemplo, para invocar a la primera función de <code>lista2</code>:</p>
<div class="highlight"><pre><span></span><code><span class="p">((</span><span class="nb">first</span> <span class="n">lista2</span><span class="p">)</span> <span class="mi">10</span><span class="p">)</span> <span class="c1">; ⇒ 15</span>
</code></pre></div>
</li>
</ul>
<hr />
<h3>Ejemplo de función que trabaja con listas de funciones: <code>aplica-funcs</code></h3>
<ul>
<li>
<p>Veamos un ejemplo de una función <code>(aplica-funcs lista-funcs x)</code> que
  recibe una lista de funciones en el parámetro <code>lista-funcs</code> y las
  aplica todas <strong>de derecha a izquierda</strong> al número que pasamos en el
  parámetro <code>x</code>.</p>
</li>
<li>
<p>Por ejemplo, la lista anterior con las funciones <code>cuadrado</code>, <code>cubo</code>
  y <code>suma-1</code>:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="n">lista</span> <span class="p">(</span><span class="nb">list</span> <span class="n">cuadrado</span> <span class="n">cubo</span> <span class="n">suma-1</span><span class="p">))</span>
</code></pre></div>
<p>la llamada a <code>(aplica-funcs lista 5)</code> devolverá :</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">cuadrado</span> <span class="p">(</span><span class="n">cubo</span> <span class="p">(</span><span class="n">suma-1</span> <span class="mi">5</span><span class="p">))</span> <span class="c1">; ⇒ 46656</span>
</code></pre></div>
</li>
<li>
<p>Implementación:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">aplica-funcs</span> <span class="n">lista-funcs</span> <span class="n">x</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="n">lista-funcs</span><span class="p">)</span>
        <span class="n">x</span>
        <span class="p">((</span><span class="nb">first</span> <span class="n">lista-funcs</span><span class="p">)</span>
            <span class="p">(</span><span class="n">aplica-funcs</span> <span class="p">(</span><span class="nb">rest</span> <span class="n">lista-funcs</span><span class="p">)</span> <span class="n">x</span><span class="p">))))</span>
</code></pre></div>
</li>
<li>
<p>Un ejemplo de uso:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="n">lista-funcs</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="n">x</span> <span class="n">x</span><span class="p">))</span>
                          <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="n">x</span> <span class="n">x</span> <span class="n">x</span><span class="p">))</span>
                          <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="n">x</span> <span class="mi">1</span><span class="p">))))</span>
<span class="p">(</span><span class="n">aplica-funcs</span> <span class="n">lista-funcs</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">⇒</span> <span class="mi">46656</span>
</code></pre></div>
</li>
</ul>
<hr />
<h3>Funciones de orden superior</h3>
<div class="admonition hint">
<p class="admonition-title">Definición</p>
<p>Las funciones de orden superior (<em>higher order functions</em> en inglés)
son funciones que reciben como parámetro otras funciones.</p>
</div>
<ul>
<li>
<p>Llamamos funciones de orden superior (<em>higher order functions</em> en
  inglés) a las funciones que toman otras como parámetro o devuelven
  otra función. Permiten generalizar soluciones con un alto grado de
  abstracción.</p>
</li>
<li>
<p>Los lenguajes de programación funcional como Scheme, Scala o Java 8
  tienen ya predefinidas algunas funciones de orden superior que
  permiten tratar listas o <em>streams</em> de una forma muy concisa y
  compacta. </p>
</li>
<li>
<p>Si alguna función no existe en el lenguaje, es posible
  implementarlas nosotros mismos</p>
</li>
<li>
<p>Veremos:</p>
<ul>
<li><code>map</code></li>
<li><code>filter</code></li>
<li><code>exists?</code> (implementada por nosotros)</li>
<li><code>for-all?</code> (implementada por nosotros)</li>
<li><code>foldr</code> y <code>foldl</code></li>
</ul>
</li>
<li>
<p>De alguna de las funciones veremos también su implementación
recursiva.</p>
</li>
<li>
<p>Terminaremos viendo cómo la utilización de funciones de orden
superior es una excelente herramienta de la programación funcional
que permite hacer código muy conciso y expresivo.</p>
</li>
</ul>
<hr />
<h3>Función <code>map</code></h3>
<ul>
<li>
<p>La función <code>map</code> recibe otra función y una
  lista. Devuelve la lista resultante de aplicar la función
  <code>transforma</code> a todos los elementos de la lista.</p>
<div class="highlight"><pre><span></span><code>(map transforma lista) -&gt; lista
</code></pre></div>
</li>
<li>
<p>La función <code>(transforma dato)</code> que usa <code>map</code> recibe como argumento
  elementos de la lista y devuelve el resultado de transformar ese
  elemento.</p>
<div class="highlight"><pre><span></span><code>(transforma elemento) -&gt; elemento
</code></pre></div>
</li>
<li>
<p>Ejemplos:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="nb">map</span> <span class="n">cuadrado</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">))</span>
<span class="c1">; ⇒ (1 4 9 16 25)</span>

<span class="p">(</span><span class="nb">map</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">str</span><span class="p">)</span> <span class="p">(</span><span class="nb">string-append</span> <span class="s2">&quot;Hola-&quot;</span> <span class="n">str</span><span class="p">))</span> <span class="o">&#39;</span><span class="p">(</span><span class="s2">&quot;me&quot;</span> <span class="s2">&quot;llamo&quot;</span> <span class="s2">&quot;Ana&quot;</span><span class="p">))</span>
<span class="c1">; ⇒ (&quot;Hola-me&quot; &quot;Hola-llamo&quot; &quot;Hola-Ana&quot;)</span>

<span class="p">(</span><span class="nb">map</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">s</span><span class="p">)</span> 
        <span class="p">(</span><span class="nb">string-length</span> <span class="p">(</span><span class="nb">symbol-&gt;string</span> <span class="n">s</span><span class="p">)))</span> <span class="o">&#39;</span><span class="p">(</span><span class="ss">Esta</span> <span class="ss">es</span> <span class="ss">una</span> <span class="ss">lista</span> <span class="ss">de</span> <span class="ss">símbolos</span><span class="p">))</span>
<span class="c1">; ⇒ (4 2 3 5 2 8)</span>
</code></pre></div>
</li>
<li>
<p>Veamos cómo se implementa <code>map</code> de forma recursiva. Llamamos a la
  función <code>mi-map</code>.</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">mi-map</span> <span class="n">f</span> <span class="n">lista</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="n">lista</span><span class="p">)</span>
        <span class="o">&#39;</span><span class="p">()</span>
        <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="n">f</span> <span class="p">(</span><span class="nb">first</span> <span class="n">lista</span><span class="p">))</span>
              <span class="p">(</span><span class="n">mi-map</span> <span class="n">f</span> <span class="p">(</span><span class="nb">rest</span> <span class="n">lista</span><span class="p">)))))</span>
</code></pre></div>
</li>
<li>
<p>La función <code>map</code> puede recibir un número variable de listas, todas
  ellas de la misma longitud:</p>
<div class="highlight"><pre><span></span><code>(map transforma lista_1 ... lista_n) -&gt; lista
</code></pre></div>
</li>
<li>
<p>En este caso la función de transforma debe recibir tantos argumentos
  como listas recibe <code>map</code>:</p>
<div class="highlight"><pre><span></span><code>(transforma dato_1 ... dato_n) -&gt; dato
</code></pre></div>
</li>
<li>
<p>La función <code>map</code> aplica <code>transforma</code> a los elementos cogidos de las
  n listas y construye así la lista resultante:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="nb">map</span> <span class="nb">+</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">10</span> <span class="mi">20</span> <span class="mi">30</span><span class="p">))</span> <span class="c1">; ⇒ (11 22 33)</span>
<span class="p">(</span><span class="nb">map</span> <span class="nb">cons</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">10</span> <span class="mi">20</span> <span class="mi">30</span><span class="p">))</span> <span class="c1">; ⇒ ((1 . 10) (2 . 20) (3 . 30))</span>
<span class="p">(</span><span class="nb">map</span> <span class="nb">&gt;</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">12</span> <span class="mi">3</span> <span class="mi">40</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">20</span> <span class="mi">0</span> <span class="mi">10</span><span class="p">))</span> <span class="c1">; ⇒ (#f #t #t)</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">mayor</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span> <span class="n">a</span> <span class="n">b</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">mayor-de-tres</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="p">)</span>
    <span class="p">(</span><span class="n">mayor</span> <span class="n">a</span> <span class="p">(</span><span class="n">mayor</span> <span class="n">b</span> <span class="n">c</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">map</span> <span class="n">mayor-de-tres</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">10</span> <span class="mi">2</span> <span class="mi">20</span> <span class="mi">-1</span> <span class="mi">34</span><span class="p">)</span> 
                   <span class="o">&#39;</span><span class="p">(</span><span class="mi">2</span> <span class="mi">3</span> <span class="mi">12</span> <span class="mi">89</span> <span class="mi">0</span><span class="p">)</span> 
                   <span class="o">&#39;</span><span class="p">(</span><span class="mi">100</span> <span class="mi">-10</span> <span class="mi">23</span> <span class="mi">45</span> <span class="mi">8</span><span class="p">))</span>
<span class="c1">; ⇒ (100 3 23 89 34)</span>
</code></pre></div>
</li>
</ul>
<div class="admonition hint">
<p class="admonition-title">Consejo</p>
<p>La función <code>map</code> recibe una o más listas de <em>n</em> elementos y devuelve otra
de <em>n</em> elementos transformados.</p>
</div>
<hr />
<h3>Función <code>filter</code></h3>
<ul>
<li>La función <code>(filter predicado lista)</code> toma como parámetro un
  predicado y una lista y devuelve como resultado los elementos de la
  lista que cumplen el <code>predicado</code>.</li>
</ul>
<div class="highlight"><pre><span></span><code>(filter predicado lista) -&gt; lista
</code></pre></div>
<ul>
<li>
<p>La función <code>(predicado elem)</code> que usa <code>filter</code> recibe elementos de
  la lista y devuelve <code>#t</code> o <code>#f</code>.</p>
<div class="highlight"><pre><span></span><code>(predicado elem) -&gt; boolean
</code></pre></div>
</li>
<li>
<p>Ejemplos:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="nb">filter</span> <span class="nb">even?</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span><span class="p">))</span>
<span class="c1">; ⇒ (2 4 6 8)</span>

<span class="p">(</span><span class="nb">filter</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">s</span><span class="p">)</span> 
           <span class="p">(</span><span class="nb">&gt;=</span> <span class="p">(</span><span class="nb">string-length</span> <span class="p">(</span><span class="nb">symbol-&gt;string</span> <span class="n">s</span><span class="p">))</span> <span class="mi">4</span><span class="p">))</span>
           <span class="o">&#39;</span><span class="p">(</span><span class="ss">Esta</span> <span class="ss">es</span> <span class="ss">una</span> <span class="ss">lista</span> <span class="ss">de</span> <span class="ss">símbolos</span><span class="p">))</span>
<span class="c1">; ⇒ (Esta lista símbolos)</span>

<span class="p">(</span><span class="nb">filter</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">pareja</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">&gt;=</span> <span class="p">(</span><span class="nb">car</span> <span class="n">pareja</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr</span> <span class="n">pareja</span><span class="p">)))</span> 
            <span class="o">&#39;</span><span class="p">((</span><span class="mi">10</span> <span class="o">.</span> <span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="mi">2</span> <span class="o">.</span> <span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="mi">8</span> <span class="o">.</span> <span class="mi">8</span><span class="p">)</span> <span class="p">(</span><span class="mi">10</span> <span class="o">.</span> <span class="mi">20</span><span class="p">)))</span>
<span class="c1">; ⇒ ((10 . 4) (8 . 8))</span>
</code></pre></div>
</li>
<li>
<p>Podemos implementar <code>filter</code> de forma recursiva. Llamamos a la
  función <code>mi-filter</code>.</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">mi-filter</span> <span class="n">pred</span> <span class="n">lista</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond</span>
    <span class="p">((</span><span class="nb">null?</span> <span class="n">lista</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">())</span>
    <span class="p">((</span><span class="n">pred</span> <span class="p">(</span><span class="nb">first</span> <span class="n">lista</span><span class="p">))</span> <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">first</span> <span class="n">lista</span><span class="p">)</span>
                              <span class="p">(</span><span class="n">mi-filter</span> <span class="n">pred</span> <span class="p">(</span><span class="nb">rest</span> <span class="n">lista</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">else</span> <span class="p">(</span><span class="n">mi-filter</span> <span class="n">pred</span> <span class="p">(</span><span class="nb">rest</span> <span class="n">lista</span><span class="p">)))))</span>
</code></pre></div>
</li>
</ul>
<div class="admonition hint">
<p class="admonition-title">Consejo</p>
<p>La función <code>filter</code> recibe una lista de <em>n</em>
elementos y una condición y devuelve otra de de <em>n</em> o menos
elementos originales filtrados por la condición.</p>
</div>
<hr />
<h3>Función <code>exists?</code> (implementada por nosotros)</h3>
<ul>
<li>
<p>La función de orden superior <code>(exists? predicado lista)</code> recibe un
  predicado y una lista y comprueba si algún elemento de la lista
  cumple ese predicado.</p>
<div class="highlight"><pre><span></span><code>(exists? predicado lista) -&gt; boolean
</code></pre></div>
</li>
<li>
<p>Igual que en <code>filter</code> el <code>predicado</code> recibe elementos de la lista y
  devuelve <code>#t</code> o <code>#f</code>.</p>
<div class="highlight"><pre><span></span><code>(predicado elem) -&gt; boolean
</code></pre></div>
</li>
<li>
<p>Implementación:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">exists?</span> <span class="n">predicado</span> <span class="n">lista</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="n">lista</span><span class="p">)</span>
      <span class="no">#f</span>
      <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="n">predicado</span> <span class="p">(</span><span class="nb">first</span> <span class="n">lista</span><span class="p">))</span>
          <span class="p">(</span><span class="n">exists?</span> <span class="n">predicado</span> <span class="p">(</span><span class="nb">rest</span> <span class="n">lista</span><span class="p">)))))</span>
</code></pre></div>
</li>
<li>
<p>Ejemplos:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">exists?</span> <span class="nb">even?</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">))</span> <span class="c1">; ⇒ #t</span>

<span class="p">(</span><span class="n">exists?</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
             <span class="p">(</span><span class="nb">&gt;</span> <span class="n">x</span> <span class="mi">10</span><span class="p">))</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">8</span><span class="p">))</span> <span class="c1">; ⇒ #f</span>
</code></pre></div>
</li>
</ul>
<hr />
<h3>Función <code>for-all?</code> (implementada por nosotros)</h3>
<ul>
<li>
<p>La función de orden superior <code>(for-all? predicado lista)</code> recibe un
  predicado y una lista y comprueba que todos los elementos de la
  lista cumplen ese predicado.</p>
</li>
<li>
<p>Implementación:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">for-all?</span> <span class="n">predicado</span> <span class="n">lista</span><span class="p">)</span>
  <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nb">null?</span> <span class="n">lista</span><span class="p">)</span>
      <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="n">predicado</span> <span class="p">(</span><span class="nb">first</span> <span class="n">lista</span><span class="p">))</span>
           <span class="p">(</span><span class="n">for-all?</span> <span class="n">predicado</span> <span class="p">(</span><span class="nb">rest</span> <span class="n">lista</span><span class="p">)))))</span>
</code></pre></div>
</li>
<li>
<p>Ejemplos:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">for-all?</span> <span class="nb">even?</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">2</span> <span class="mi">4</span> <span class="mi">6</span><span class="p">))</span> <span class="c1">; ⇒ #t</span>

<span class="p">(</span><span class="n">for-all?</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
             <span class="p">(</span><span class="nb">&gt;</span> <span class="n">x</span> <span class="mi">10</span><span class="p">))</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">12</span> <span class="mi">30</span> <span class="mi">50</span> <span class="mi">80</span><span class="p">))</span> <span class="c1">; ⇒ #t</span>
</code></pre></div>
</li>
</ul>
<hr />
<h3>Función <code>foldr</code></h3>
<ul>
<li>
<p>El nombre <code>fold</code> significa <em>plegado</em>. La función <code>foldr</code>
  recorre una lista y la va "plegando", devolviendo un único valor
  como resultado.</p>
<div class="highlight"><pre><span></span><code>(foldr combina base lista) -&gt; valor
</code></pre></div>
</li>
<li>
<p>El plegado lo realiza la <strong>función de plegado</strong> <code>(combina dato
  resultado)</code>, que recibe un dato de la lista y lo acumula con el otro
  parámetro <code>resultado</code> (al que debemos dar un valor inicial y es el
  parámetro <code>base</code> de la función <code>foldr</code>).</p>
<div class="highlight"><pre><span></span><code>(combina dato resultado) -&gt; resultado
</code></pre></div>
</li>
<li>
<p>La función <code>combina</code> se aplica a los elementos de la lista <strong>de
  derecha a izquierda</strong>, empezando por el último elemento de la lista
  y el valor inicial <code>base</code> y aplicándose sucesivamente a los
  resultados que se van obteniendo.</p>
</li>
<li>
<p>Veamos un ejemplo. Supongamos que la función de plegado es una
  función que suma el dato que viene de la lista con el valor
  acumulado:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">suma</span> <span class="n">dato</span> <span class="n">resultado</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">+</span> <span class="n">dato</span> <span class="n">resultado</span><span class="p">))</span>
</code></pre></div>
</li>
<li>
<p>Llamamos a los parámetros <code>dato</code> y <code>resultado</code> para remarcar que el
  primer parámetro se va a coger de la lista y el segundo del
  resultado calculado.</p>
</li>
<li>
<p>Veamos qué pasa cuando hacemos un <code>foldr</code> con esta función
  <code>suma</code> y la lista <code>(1 2 3)</code> y con el número 0 como base:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="nb">foldr</span> <span class="n">suma</span> <span class="mi">0</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span> <span class="c1">; ⇒ 6</span>
</code></pre></div>
</li>
<li>
<p>La función <code>suma</code> se va a ir aplicando a todos los elementos de la
  lista de <strong>derecha a izquierda</strong>, empezando por el valor base (0) y
  el último elemento de la lista (3) y cogiendo el resultado obtenido
  y utilizándolo como nuevo parámetro <code>resultado</code> en la siguiente
  llamada.</p>
</li>
<li>
<p>En concreto, la secuencia de llamadas a la función <code>suma</code> serán las
  siguientes:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">suma</span> <span class="mi">3</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">; ⇒ 3</span>
<span class="p">(</span><span class="n">suma</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span> <span class="c1">; ⇒ 5</span>
<span class="p">(</span><span class="n">suma</span> <span class="mi">1</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">; ⇒ 6</span>
</code></pre></div>
</li>
<li>
<p>Otro ejemplo de uso:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="nb">foldr</span> <span class="nb">string-append</span> <span class="s2">&quot;****&quot;</span> <span class="o">&#39;</span><span class="p">(</span><span class="s2">&quot;hola&quot;</span> <span class="s2">&quot;que&quot;</span> <span class="s2">&quot;tal&quot;</span><span class="p">))</span> 
<span class="c1">; ⇒ &quot;holaquetal****&quot;</span>
</code></pre></div>
</li>
<li>
<p>En este caso la secuencia de llamadas a <code>string-append</code> que se van a
  producir son:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="nb">string-append</span> <span class="s2">&quot;tal&quot;</span> <span class="s2">&quot;****&quot;</span><span class="p">)</span> <span class="c1">; ⇒ &quot;tal****&quot;</span>
<span class="p">(</span><span class="nb">string-append</span> <span class="s2">&quot;que&quot;</span> <span class="s2">&quot;tal****&quot;</span><span class="p">)</span> <span class="c1">; ⇒ &quot;quetal****&quot;</span>
<span class="p">(</span><span class="nb">string-append</span> <span class="s2">&quot;hola&quot;</span> <span class="s2">&quot;quetal****&quot;</span><span class="p">)</span> <span class="c1">; ⇒ &quot;holaquetal****&quot;</span>
</code></pre></div>
</li>
<li>
<p>Otros ejemplos:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="nb">foldr</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">x</span> <span class="n">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="n">x</span> <span class="n">y</span><span class="p">))</span> <span class="mi">1</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span><span class="p">))</span> <span class="c1">; ⇒ 40320</span>
<span class="p">(</span><span class="nb">foldr</span> <span class="nb">cons</span> <span class="o">&#39;</span><span class="p">()</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">))</span> <span class="c1">; ⇒ (1 2 3 4)</span>
</code></pre></div>
</li>
<li>
<p>La <strong>implementación recursiva</strong> en Scheme de la función <code>foldr</code> es
  la siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">mi-foldr</span> <span class="n">combina</span> <span class="n">base</span> <span class="n">lista</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="n">lista</span><span class="p">)</span>
      <span class="n">base</span>
      <span class="p">(</span><span class="n">combina</span> <span class="p">(</span><span class="nb">first</span> <span class="n">lista</span><span class="p">)</span> <span class="p">(</span><span class="n">mi-foldr</span> <span class="n">combina</span> <span class="n">base</span> <span class="p">(</span><span class="nb">rest</span> <span class="n">lista</span><span class="p">)))))</span>
</code></pre></div>
</li>
</ul>
<h3>Función <code>foldl</code></h3>
<ul>
<li>
<p>La función <code>(foldl combina base lista)</code> (<em>fold left</em>) es similar a
<code>foldr</code> con la diferencia de que la secuencia de aplicaciones de la
función de plegado se hace <strong>de izquierda a derecha</strong> en lugar de
derecha a izquierda.</p>
</li>
<li>
<p>El perfil de la función de plegado es el mismo que en <code>foldr</code>:</p>
<div class="highlight"><pre><span></span><code>(combina dato resultado) -&gt; resultado
</code></pre></div>
</li>
<li>
<p>Por ejemplo, si la función de combinación es <code>string-append</code>:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="nb">foldl</span> <span class="nb">string-append</span> <span class="s2">&quot;****&quot;</span> <span class="o">&#39;</span><span class="p">(</span><span class="s2">&quot;hola&quot;</span> <span class="s2">&quot;que&quot;</span> <span class="s2">&quot;tal&quot;</span><span class="p">))</span> 
<span class="c1">; ⇒ &quot;talquehola****&quot;</span>
</code></pre></div>
</li>
<li>
<p>La secuencia de llamadas a <code>string-append</code> es:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="nb">string-append</span> <span class="s2">&quot;hola&quot;</span> <span class="s2">&quot;****&quot;</span><span class="p">)</span> <span class="c1">; ⇒ &quot;hola****&quot;</span>
<span class="p">(</span><span class="nb">string-append</span> <span class="s2">&quot;que&quot;</span> <span class="s2">&quot;hola****&quot;</span><span class="p">)</span> <span class="c1">; ⇒ &quot;quehola****&quot;</span>
<span class="p">(</span><span class="nb">string-append</span> <span class="s2">&quot;tal&quot;</span> <span class="s2">&quot;quehola****&quot;</span><span class="p">)</span> <span class="c1">; ⇒ &quot;talquehola****&quot;</span>
</code></pre></div>
</li>
<li>
<p>Otro ejemplo:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="nb">foldl</span> <span class="nb">cons</span> <span class="o">&#39;</span><span class="p">()</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">))</span> <span class="c1">; ⇒ (4 3 2 1)</span>
</code></pre></div>
</li>
<li>
<p>La implementación de <code>foldl</code> la veremos cuando hablemos de
  recursión por la cola (<em>tail recursion</em>) en el próximo tema.</p>
</li>
</ul>
<div class="admonition hint">
<p class="admonition-title">Consejo</p>
<p>Las funciones <code>foldr</code> o <code>foldl</code> reciben una lista de
datos y devuelven un único resultado </p>
</div>
<hr />
<h3>Funciones con FOS y expresiones lambda</h3>
<ul>
<li>
<p>Veamos por último unos ejemplos en los que definimos funciones
  que iteran sobre listas usando funciones de orden superior (FOS) y expresiones
  lambda.</p>
</li>
<li>
<p>La iteración no se realizará mediante recursividad, sino que serán
  las FOS las que la implementen.</p>
</li>
</ul>
<div class="admonition hint">
<p class="admonition-title">Combinación de funciones de orden superior</p>
<p>La combinación de funciones de orden superior y expresiones lamba
para definir funciones iterativas sobre listas es una de
las características más potentes de la programación funcional.</p>
</div>
<hr />
<h3>Función <code>(suma-n n lista)</code></h3>
<ul>
<li>
<p>Supongamos que queremos definir una función <code>(suma-n n lista)</code> que
  devuelve la lista resultante el resultado de sumar un número <code>n</code> a
  todos los elementos de una lista.</p>
</li>
<li>
<p>Podemos hacerlo de forma recursiva:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">suma-n</span> <span class="n">n</span> <span class="n">lista</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="n">lista</span><span class="p">)</span>
        <span class="o">&#39;</span><span class="p">()</span>
        <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">first</span> <span class="n">lista</span><span class="p">)</span> <span class="n">n</span><span class="p">)</span>
              <span class="p">(</span><span class="n">suma-n</span> <span class="n">n</span> <span class="p">(</span><span class="nb">rest</span> <span class="n">lista</span><span class="p">)))))</span>
</code></pre></div>
</li>
<li>
<p>Funciona de la siguiente manera:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">suma-n</span> <span class="mi">10</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">))</span>
<span class="c1">; ⇒ (11 12 13 14)</span>
</code></pre></div>
</li>
<li>
<p>¿Podemos implementar <code>suma-n</code> usando una llamada a <code>map</code>?</p>
</li>
</ul>
<p style="margin-bottom:3cm;"></p>

<ul>
<li>
<p>Sí, pasándole a map una función construida con una expresión lambda
  en la que se usa el parámetro <code>n</code>:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">suma-n</span> <span class="n">n</span> <span class="n">lista</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">map</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="n">x</span> <span class="n">n</span><span class="p">))</span> <span class="n">lista</span><span class="p">))</span>
</code></pre></div>
</li>
<li>
<p>Otro ejemplo: Función <code>suma-parejas</code></p>
<h2><div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">suma-parejas</span> <span class="n">lista-parejas</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">foldr</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">pareja</span> <span class="n">resultado</span><span class="p">)</span>
               <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">car</span> <span class="n">pareja</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr</span> <span class="n">pareja</span><span class="p">)</span> <span class="n">resultado</span><span class="p">))</span> <span class="mi">0</span> <span class="n">lista-parejas</span><span class="p">))</span>

<span class="p">(</span><span class="n">suma-parejas</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nb">cons</span> <span class="mi">3</span> <span class="mi">6</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons</span> <span class="mi">2</span> <span class="mi">9</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons</span> <span class="mi">-1</span> <span class="mi">8</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons</span> <span class="mi">9</span> <span class="mi">3</span><span class="p">)))</span> <span class="c1">; ⇒ 39</span>
</code></pre></div></h2>
</li>
</ul>
<h3>Composición de funciones de orden superior</h3>
<ul>
<li>
<p>En la composición de funciones de orden superior, la lista 
resultante de la salida de una función se utiliza como entrada de la
siguiente. </p>
</li>
<li>
<p>Supongamos que queremos implementar una función que sume un número
<code>n</code> a todos los elementos de una lista (igual que la anterior) y
después que sume todos los elementos resultantes.</p>
</li>
<li>
<p>¿Cómo lo haríamos? (podemos reutilizar el código del ejemplo anterior)</p>
</li>
</ul>
<p style="margin-bottom:3cm;"></p>

<ul>
<li>
<p>Solución:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">suma-n-total</span> <span class="n">n</span> <span class="n">lista</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">foldr</span> <span class="nb">+</span> <span class="mi">0</span>
       <span class="p">(</span><span class="nb">map</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="n">x</span> <span class="n">n</span><span class="p">))</span> <span class="n">lista</span><span class="p">)))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">suma-n-total</span> <span class="mi">100</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">))</span> <span class="c1">; ⇒ 410</span>
</code></pre></div>
</li>
<li>
<p>Otro ejemplo: queremos contar aquellas parejas cuya suma de ambos números
es mayor que un umbral (por ejemplo, 10).</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="n">lista-parejas</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nb">cons</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> 
                            <span class="p">(</span><span class="nb">cons</span> <span class="mi">3</span> <span class="mi">8</span><span class="p">)</span> 
                            <span class="p">(</span><span class="nb">cons</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span> 
                            <span class="p">(</span><span class="nb">cons</span> <span class="mi">9</span> <span class="mi">6</span><span class="p">)))</span>
<span class="p">(</span><span class="n">cuenta-mayores-que</span> <span class="mi">10</span> <span class="n">lista-parejas</span><span class="p">)</span> <span class="c1">; ⇒ 2</span>
</code></pre></div>
</li>
<li>
<p>¿Cómo se implementaría componiendo funciones de orden superior?:</p>
</li>
</ul>
<p style="margin-bottom:3cm;"></p>

<ul>
<li>
<p>Solución:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">cuenta-mayores-que</span> <span class="n">n</span> <span class="n">lista-parejas</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">length</span>
   <span class="p">(</span><span class="nb">filter</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
             <span class="p">(</span><span class="nb">&gt;</span> <span class="n">x</span> <span class="n">n</span><span class="p">))</span> <span class="p">(</span><span class="nb">map</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">pareja</span><span class="p">)</span>
                             <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">car</span> <span class="n">pareja</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr</span> <span class="n">pareja</span><span class="p">)))</span> <span class="n">lista-parejas</span><span class="p">))))</span>
</code></pre></div>
</li>
</ul>
<hr />
<h3>Función <code>(contienen-letra caracter lista-pal)</code></h3>
<ul>
<li>
<p>Queremos definir la función <code>(contienen-letra
  caracter lista-pal)</code> que devuelve las palabras de una lista que
  contienen un determinado carácter, usando la función <code>filter</code> y
  alguna función auxiliar</p>
</li>
<li>
<p>Por ejemplo:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">contienen-letra</span> <span class="sc">#\a</span> <span class="o">&#39;</span><span class="p">(</span><span class="s2">&quot;En&quot;</span> <span class="s2">&quot;un&quot;</span> <span class="s2">&quot;lugar&quot;</span> <span class="s2">&quot;de&quot;</span> <span class="s2">&quot;la&quot;</span> <span class="s2">&quot;Mancha&quot;</span><span class="p">))</span>
<span class="c1">; ⇒ (&quot;lugar&quot; &quot;la&quot; &quot;Mancha&quot;)</span>
</code></pre></div>
</li>
<li>
<p>Necesitamos el predicado auxiliar <code>(letra-en-pal? caracter pal)</code> que
  comprueba si una cadena contiene un carácter. Por ejemplo:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">letra-en-pal?</span> <span class="sc">#\a</span> <span class="s2">&quot;Hola&quot;</span><span class="p">)</span> <span class="c1">; ⇒ #t</span>
<span class="p">(</span><span class="n">letra-en-pal?</span> <span class="sc">#\a</span> <span class="s2">&quot;Pepe&quot;</span><span class="p">)</span> <span class="c1">; ⇒ #f</span>
</code></pre></div>
</li>
<li>
<p>¿Lo podemos implementar obteniendo una lista de caracteres a partir
  de la cadena y usando la función <code>exists?</code>?</p>
</li>
</ul>
<p style="margin-bottom:3cm;"></p>

<ul>
<li>
<p>Solución:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">letra-en-pal?</span> <span class="n">caracter</span> <span class="n">palabra</span><span class="p">)</span>
    <span class="p">(</span><span class="n">exists?</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> 
                <span class="p">(</span><span class="nb">equal?</span> <span class="n">c</span> <span class="n">caracter</span><span class="p">))</span> <span class="p">(</span><span class="nb">string-&gt;list</span> <span class="n">palabra</span><span class="p">)))</span>
</code></pre></div>
</li>
<li>
<p>Ahora ya podemos implementar <code>contienen-letra</code> usando otra vez la
  función de orden superior <code>filter</code> y la función anterior en la
  expresión lambda que hace el filtrado:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">contienen-letra</span> <span class="n">caracter</span> <span class="n">lista-pal</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">filter</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">pal</span><span class="p">)</span>
              <span class="p">(</span><span class="n">letra-en-pal?</span> <span class="n">caracter</span> <span class="n">pal</span><span class="p">))</span> <span class="n">lista-pal</span><span class="p">))</span>
</code></pre></div>
</li>
</ul></body>

</html>
