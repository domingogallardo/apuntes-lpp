



<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Ambitos let clousures - LPP</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Ubuntu","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="LPP" class="md-header-nav__button md-logo">
          
            <img src="../../imagenes/logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              LPP
            </span>
            <span class="md-header-nav__topic">
              
                Ambitos let clousures
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="LPP" class="md-nav__button md-logo">
      
        <img src="../../imagenes/logo.png" width="48" height="48">
      
    </a>
    LPP
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Teoría
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Teoría
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tema00-descripcion-asignatura/tema00-descripcion-asignatura.html" title="Descripción de la asignatura" class="md-nav__link">
      Descripción de la asignatura
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tema01-historia-lenguajes-programacion/tema01-historia-lenguajes-programacion.html" title="Tema 1: Historia de los lenguajes de programación" class="md-nav__link">
      Tema 1: Historia de los lenguajes de programación
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Seminarios
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Seminarios
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../seminarios/seminario1-scheme/seminario1-scheme.html" title="Seminario de Scheme" class="md-nav__link">
      Seminario de Scheme
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Ambitos let clousures</h1>
                
                <h2 id="6-ambitos-de-variables-let-y-closures"><a name="6"></a>6. Ámbitos de variables, let y closures<a class="headerlink" href="#6-ambitos-de-variables-let-y-closures" title="Permanent link">&para;</a></h2>
<p>Ahora que hemos introducido la forma especial <code>lambda</code> y la idea de
que una función es un objeto de primera clase, podemos revisar el
concepto de ámbito de variables en Scheme e introducir un importante
concepto: clausura
(<em><a href="https://en.wikipedia.org/wiki/Closure_(computer_programming)">closure</a></em>
en inglés).</p>
<h3 id="61-ambitos-de-variables"><a name="6-1"></a> 6.1. Ámbitos de variables<a class="headerlink" href="#61-ambitos-de-variables" title="Permanent link">&para;</a></h3>
<p>El concepto del <strong>ámbito</strong> de vida de las variables es un concepto
fundamental en los lenguajes de programación. En inglés se utiliza el
término
<em><a href="https://en.wikipedia.org/wiki/Scope_(computer_science)">scope</a></em>.</p>
<p>Cuando se define una variable, asociándole un valor, esta asociación
tiene una extensión determinada, ya sea en términos de tiempo de
compilación (<strong>ámbito léxico</strong>) como en términos de tiempo de
ejecución (<strong>ámbito dinámico</strong>). El ámbito de una variable determina
cuándo podemos referirnos a ella para recuperar el valor asociado.</p>
<p>Al conjunto de variables disponibles en una parte del programa o en
una parte de su ejecución se denomina <strong>contexto</strong> o <strong>entorno</strong>
(<em>context</em> o <em>environment</em>).</p>
<h4>Variables de ámbito global</h4>
<p>Una variable definida en el programa con la instrucción <code>define</code> tiene
un ámbito global.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="err">(define a &quot;hola&quot;)</span>
<span class="err">(define b (string-append &quot;adios&quot; a))</span>
<span class="err">(define cuadrado (lambda (x) (* x x)))</span>
</pre></div>
</td></tr></table>

<p>Todas las variables definidas fuera de funciones forman parte del
<strong>entorno global</strong> del programa.</p>
<h4>Variables de ámbito local</h4>
<p>Como en la mayoría de lenguajes de programación, en Scheme se crea un
<strong>entorno local</strong> cada vez que se invoca a una función. En este
entorno local los argumentos de la función toman los valores de los
parámetros usados en la llamada a la función. Consideramos, por tanto,
estos parámetros como variables de ámbito local de la función.</p>
<p>Podemos usar en un entorno local una variable con el mismo nombre que
en el entorno global. Cuando se ejecute el código de la función se
evaluará la variable de ámbito local.</p>
<p>Por ejemplo, supongamos las expresiones:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="nv">x</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">suma-3</span> <span class="nv">x</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="mi">3</span><span class="p">))</span>

<span class="p">(</span><span class="nf">suma-3</span> <span class="mi">12</span><span class="p">)</span>
<span class="err">⇒</span> <span class="mi">15</span>
</pre></div>
</td></tr></table>

<p>Cuando se ejecuta la expresión <code>(+ x 3)</code> en la invocación a <code>(suma-3
12)</code> el valor de <code>x</code> es 12, no es 5, devolviéndose 15.</p>
<p>Una vez realizada la invocación, desparece el entorno local y las
variables locales definidas en él, recuperándose el contexto
global. Por ejemplo, en la siguiente expresión, una vez realizada la
invocación a <code>(suma-3 12)</code> se devuelve el número 15 y se evalúa en el
entorno global la expresión <code>(+ 15 x)</code>. En este contexto la variable
<code>x</code> vale 5 por lo que la expresión devuelve 20.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="nv">x</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">suma-3</span> <span class="nv">x</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="mi">3</span><span class="p">))</span>

<span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">suma-3</span> <span class="mi">12</span><span class="p">)</span> <span class="nv">x</span><span class="p">)</span>
<span class="err">⇒</span> <span class="mi">20</span>
</pre></div>
</td></tr></table>

<p>En el entorno local también se pueden utilizar variables definidas en
el entorno global. Por ejemplo:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">(</span><span class="n">define</span> <span class="n">y</span> <span class="mi">12</span><span class="p">)</span>
<span class="p">(</span><span class="n">define</span> <span class="p">(</span><span class="n">suma</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">bis</span> <span class="n">x</span><span class="p">)</span>
   <span class="p">(</span><span class="o">+</span> <span class="n">x</span> <span class="n">y</span> <span class="mi">3</span><span class="p">))</span>

<span class="p">(</span><span class="n">suma</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">bis</span> <span class="mi">5</span><span class="p">)</span> 
<span class="err">⇒</span> <span class="mi">20</span>
</pre></div>
</td></tr></table>

<p>La expresión <code>(+ x 3 y)</code> se evalúa en el entorno local en el que <code>x</code>
vale 5. Al no estar definida la variable <code>y</code> en este entorno local, se
usa su definición de ámbito global.</p>
<h3 id="62-forma-especial-let"><a name="6-2"></a> 6.2 Forma especial let<a class="headerlink" href="#62-forma-especial-let" title="Permanent link">&para;</a></h3>
<h4>Forma especial let</h4>
<p>En Scheme se define la forma especial let que permite crear un entorno
local en el que se da valor a variables y se evalúa una expresión.</p>
<p>Sintaxis:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">&lt;var1&gt;</span> <span class="nv">&lt;exp-1&gt;</span><span class="p">)</span>
        <span class="o">...</span>
      <span class="p">(</span><span class="nf">&lt;varn&gt;</span> <span class="nv">&lt;exp-n&gt;</span><span class="p">))</span>
    <span class="nv">&lt;cuerpo&gt;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Las variables <code>var1</code>, … <code>varn</code> toman los valores devueltos por las
expresiones <code>exp1</code>, … <code>expn</code> y el cuerpo se evalúa con esos valores.</p>
<p>Por ejemplo:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="nv">x</span> <span class="mi">10</span><span class="p">)</span>
<span class="p">(</span><span class="k">define </span><span class="nv">y</span> <span class="mi">20</span><span class="p">)</span>
<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">x</span> <span class="mi">1</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">y</span> <span class="mi">2</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">z</span> <span class="mi">3</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">))</span>
<span class="err">⇒</span> <span class="mi">6</span>
</pre></div>
</td></tr></table>

<h4>El ámbito de las variables definidas en el let es local</h4>
<p>Las variables definidas en el <code>let</code> sólo tienen valores en el entorno
creado por la forma especial.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="nv">x</span> <span class="mi">10</span><span class="p">)</span>
<span class="p">(</span><span class="k">define </span><span class="nv">y</span> <span class="mi">20</span><span class="p">)</span>
<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">x</span> <span class="mi">1</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">y</span> <span class="mi">2</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">z</span> <span class="mi">3</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">))</span>
<span class="err">⇒</span> <span class="mi">6</span>
</pre></div>
</td></tr></table>

<p>Cuando ha terminado la evaluación del <code>let</code> el ámbito local desaparece
y quedan los valores definidos en el ámbito global.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nv">x</span> <span class="err">⇒</span> <span class="mi">5</span>
<span class="nv">y</span> <span class="err">⇒</span> <span class="nv">error,</span> <span class="nv">no</span> <span class="nv">definida</span>
</pre></div>
</td></tr></table>

<h4><code>Let</code> permite usar variables definidas en un ámbito en el que se ejecuta el <code>let</code></h4>
<p>Al igual que en la invocación a funciones, desde el ámbito definido
por el <code>let</code> se puede usar las variables del entorno en el que se está
ejecutando el <code>let</code>. Por ejemplo, en el siguiente código se usa la
variable z definida en el ámbito global.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="nv">z</span> <span class="mi">8</span><span class="p">)</span>
<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">x</span> <span class="mi">1</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">y</span> <span class="mi">2</span><span class="p">))</span>
   <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">))</span>
<span class="err">⇒</span> <span class="mi">11</span>
</pre></div>
</td></tr></table>

<h4>Variables en las definiciones del <code>let</code></h4>
<p>Las expresiones que dan valor a las variables del <code>let</code> se evalúan
todas en el entorno en el que se ejecuta el <code>let</code>, antes de crear las
variables locales.  No se realiza una asignación secuencial:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="nv">x</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">w</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="mi">3</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">z</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">w</span> <span class="mi">2</span><span class="p">)))</span> <span class="c1">;; Error: w no está definida</span>
    <span class="p">(</span><span class="nb">+ </span><span class="nv">w</span> <span class="nv">z</span><span class="p">))</span>
</pre></div>
</td></tr></table>

<h5>Semántica del <code>let</code></h5>
<p>Para evaluar una expresión <code>let</code> debemos seguir las siguientes reglas:</p>
<ol>
<li>Evaluar todas las expresiones de la derecha de las variables y
   guardar sus valores en variables auxiliares locales.</li>
<li>Definir un ámbito local en el que se ligan las variables del let
   con los valores de las variables auxiliares.</li>
<li>Evaluar el cuerpo del let en el ámbito local</li>
</ol>
<h5>Let se define utilizando lambda</h5>
<p>La semántica anterior queda clara cuando comprobamos que let se puede
definir en función de lambda. En general, la expresión:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">&lt;var1&gt;</span> <span class="nv">&lt;exp1&gt;</span><span class="p">)</span> <span class="o">...</span> <span class="p">(</span><span class="nf">&lt;varn&gt;</span> <span class="nv">&lt;expn&gt;</span><span class="p">))</span> <span class="nv">&lt;cuerpo&gt;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>se puede implementar con la siguiente llamada a lambda:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">((</span><span class="k">lambda </span><span class="p">(</span><span class="nf">&lt;var1&gt;</span> <span class="o">...</span> <span class="nv">&lt;varn&gt;</span><span class="p">)</span> <span class="nv">&lt;cuerpo&gt;</span><span class="p">)</span> <span class="nv">&lt;exp1&gt;</span> <span class="o">...</span> <span class="nv">&lt;expn&gt;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Para ejecutar un <code>let</code> con un <code>lambda</code> se debe crear un procedimiento
en tiempo de ejecución con tantas variables como las variables del
<code>let</code>, con el cuerpo del <code>let</code>, y se debe invocar a dicho
procedimiento con las expresiones de las variables del <code>let</code>. Esas
expresiones se evalúan antes de invocar al procedimiento y la
invocación se realiza con los resultados. La invocación crea un
entorno local con los parámetros del procedimiento (las variables del
<code>let</code>) asociados a los valores, y en este ámbito local se ejecuta el
cuerpo del procedimiento (el cuerpo del <code>let</code>).</p>
<p>Por ejemplo:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="err">(let ((x (+ 2 3))</span>
<span class="err">      (y (+ x 3)))</span>
<span class="err">    (+ x y))</span>
</pre></div>
</td></tr></table>

<p>Equivale a:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">((</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="nv">y</span><span class="p">))</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">2</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>
</td></tr></table>

<h4>Let dentro de funciones</h4>
<p>Podemos usar <code>let</code> en el cuerpo de funciones para crear nuevas
variables locales, además de los parámetros de la función</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">suma-cuadrados</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">cuadrado-x</span> <span class="p">(</span><span class="nf">cuadrado</span> <span class="nv">x</span><span class="p">))</span>
          <span class="p">(</span><span class="nf">cuadrado-y</span> <span class="p">(</span><span class="nf">cuadrado</span> <span class="nv">y</span><span class="p">)))</span>
        <span class="p">(</span><span class="nb">+ </span><span class="nv">cuadrado-x</span> <span class="nv">cuadrado-y</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">suma-cuadrados</span> <span class="mi">4</span> <span class="mi">10</span><span class="p">)</span>
<span class="err">⇒</span> <span class="mi">116</span>
</pre></div>
</td></tr></table>

<p>Cuando se invoca <code>(suma-cuadrados 4 10)</code> se crea un entorno local en
el que las variables <code>x</code> e <code>y</code> toman el valor <code>4</code> y <code>10</code> y en el que
se ejecuta la forma especial <code>let</code>. Esta forma especial crea a su vez
un entorno local en el que se definen las variables <code>cuadrado-x</code> y
<code>cuadrado-y</code> que toman los valores devueltos por las expresiones
<code>(cuadrado x)</code> y <code>(cuadrado y)</code>: <code>16</code> y <code>100</code>. En este entorno local
se evalúa la expresión <code>(+ cuadrado-x cuadrado-y)</code>.</p>
<p>El uso de <code>let</code> permite aumentar la legibilidad de los programas,
dando nombre a expresiones:</p>
<p>Por ejemplo:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">distancia</span> <span class="nv">x1</span> <span class="nv">y1</span> <span class="nv">x2</span> <span class="nv">y2</span><span class="p">)</span>
   <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">distancia-x</span> <span class="p">(</span><span class="nb">- </span><span class="nv">x2</span> <span class="nv">x1</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">distancia-y</span> <span class="p">(</span><span class="nb">- </span><span class="nv">y2</span> <span class="nv">y1</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">sqrt </span><span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">cuadrado</span> <span class="nv">distancia-x</span><span class="p">)</span>
               <span class="p">(</span><span class="nf">cuadrado</span> <span class="nv">distancia-y</span><span class="p">)))))</span>
</pre></div>
</td></tr></table>

<p>Otro ejemplo:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">intersecta-intervalo</span> <span class="nv">a1</span> <span class="nv">a2</span> <span class="nv">b1</span> <span class="nv">b2</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">dentro-b1</span> <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="nv">b1</span> <span class="nv">a1</span><span class="p">)</span>
                          <span class="p">(</span><span class="nb">&lt;= </span><span class="nv">b1</span> <span class="nv">a2</span><span class="p">)))</span>
          <span class="p">(</span><span class="nf">dentro-b2</span> <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="nv">b2</span> <span class="nv">a1</span><span class="p">)</span>
                          <span class="p">(</span><span class="nb">&lt;= </span><span class="nv">b2</span> <span class="nv">a2</span><span class="p">))))</span>
        <span class="p">(</span><span class="k">or </span><span class="nv">dentro-b1</span> <span class="nv">dentro-b2</span><span class="p">)))</span>
</pre></div>
</td></tr></table>

<h3 id="63-clausuras"><a name="6-3"></a> 6.3. Clausuras<a class="headerlink" href="#63-clausuras" title="Permanent link">&para;</a></h3>
<p>Vamos a terminar explicando el concepto de <em>clausura</em>. Hemos visto que
las funciones son objetos de primera clase de Scheme y que es posible
crear funciones en tiempo de ejecución con la forma especial <code>lambda</code>.</p>
<p>Una clausura es una función devuelta por otra función. La clausura
<strong>captura las variables locales</strong> de la función principal y puede
usarlas en su propio código cuando este se invoque posteriormente.</p>
<p>Veamos un ejemplo. Supongamos que definimos la siguiente función
<code>(make-sumador k)</code> que devuelve otra función.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">(</span><span class="n">define</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">sumador</span> <span class="n">k</span><span class="p">)</span>
    <span class="p">(</span><span class="n">lambda</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">(</span><span class="o">+</span> <span class="n">x</span> <span class="n">k</span><span class="p">)))</span>

<span class="p">(</span><span class="n">define</span> <span class="n">f</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">sumador</span> <span class="mi">10</span><span class="p">))</span>
<span class="p">(</span><span class="n">f</span> <span class="mi">2</span><span class="p">)</span>
<span class="err">⇒</span> <span class="mi">12</span>
</pre></div>
</td></tr></table>

<p>En la función <code>(make-sumador k)</code> se llama a la forma especial lambda
para crear un procedimiento. El procedimiento devuelto es lo que se
denomina <strong>clausura</strong>. En este caso la clausura captura la variable
local <code>k</code> (el parámetro de <code>make-sumador</code>) y usa su valor cuando
posteriormente se invoca. Cuando se invoca a <code>(f 2)</code> se ejecuta la
clausura y se crea un nuevo entorno local en el que <code>x</code> (el parámetro
de la clausura) vale <code>2</code> y en el que se usa la variable <code>k</code> capturada.</p>
<p>En la invocación anterior <code>(f 2)</code>, cuando se ejecuta la expresión <code>(+
x k)</code> las variables tienen los siguientes valores:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">x</span><span class="o">:</span> <span class="mi">2</span> <span class="o">(</span><span class="n">variable</span> <span class="n">local</span> <span class="n">de</span> <span class="n">la</span> <span class="n">clausura</span><span class="o">)</span>
<span class="n">k</span><span class="o">:</span> <span class="mi">10</span> <span class="o">(</span><span class="n">valor</span> <span class="n">capturado</span> <span class="n">del</span> <span class="n">entorno</span> <span class="n">local</span> <span class="n">en</span> <span class="n">el</span> <span class="n">que</span> <span class="n">se</span> <span class="n">creó</span> <span class="n">la</span> <span class="n">clausura</span>
</pre></div>
</td></tr></table>

<h4>Las variables locales creadas en un <code>let</code> también se capturan en las clausuras</h4>
<p>Veamos el siguiente ejemplo, en el que creamos una función en un
entorno local creado por un <code>let</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="nv">x</span> <span class="mi">10</span><span class="p">)</span>
<span class="p">(</span><span class="k">define </span><span class="nv">y</span> <span class="mi">12</span><span class="p">)</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">prueba</span> <span class="nv">x</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">y</span> <span class="mi">3</span><span class="p">))</span>
        <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">z</span><span class="p">)</span> 
            <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">h</span> <span class="p">(</span><span class="nf">prueba</span> <span class="mi">5</span><span class="p">))</span>
<span class="p">(</span><span class="nf">h</span> <span class="mi">2</span><span class="p">)</span>
<span class="err">⇒</span> <span class="mi">8</span>
</pre></div>
</td></tr></table>

<p>Sucede lo siguiente:</p>
<ol>
<li>Se invoca la expresión <code>(prueba 5)</code>. Esto crea un entorno local en
   el que se le da a la variable <code>x</code> (el parámetro de <code>prueba</code>) el
   valor <code>5</code>. En este contexto se ejecuta el <code>let</code>, que crea otro
   entorno local en el que <code>y</code> vale 3. En el contexto del <code>let</code> se
   crea una clausura con la invocación de la expresión lambda <code>(lambda
   (z) (+ x y z))</code>.</li>
<li>La clausura captura las variables locales <code>x</code> e <code>y</code> con sus valores
   5 y 3 y la función <code>prueba</code> la devuelve como resultado de la
   invocación.</li>
<li>La clausura se guarda en la variable <code>h</code>.</li>
<li>
<p>Con la invocación <code>(h 2)</code> se invoca a la clausura, lo que crea un
   entorno local en el que se encuentran las siguientes variables:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">z</span><span class="o">:</span> <span class="mi">2</span> <span class="o">(</span><span class="n">parámetro</span> <span class="n">de</span> <span class="n">la</span> <span class="n">clausura</span><span class="o">)</span>
<span class="n">x</span><span class="o">:</span> <span class="mi">5</span> <span class="o">(</span><span class="n">variable</span> <span class="n">local</span> <span class="n">de</span> <span class="n">la</span> <span class="n">función</span> <span class="n">prueba</span> <span class="n">capturada</span> <span class="n">en</span> <span class="n">el</span> <span class="n">momento</span> <span class="n">de</span> <span class="n">creación</span> <span class="n">de</span> <span class="n">la</span> <span class="n">clausura</span><span class="o">))</span>
<span class="n">y</span><span class="o">:</span> <span class="mi">3</span> <span class="o">(</span><span class="n">variable</span> <span class="n">local</span> <span class="n">del</span> <span class="n">let</span> <span class="n">capturada</span> <span class="n">en</span> <span class="n">el</span> <span class="n">momento</span> <span class="n">de</span> <span class="n">creación</span> <span class="n">de</span> <span class="n">la</span> <span class="n">clausura</span><span class="o">)</span>
</pre></div>
</td></tr></table>

</li>
<li>
<p>En este contexto se ejecuta la expresión <code>(+ x y z)</code>, que devuelve 10.</p>
</li>
</ol>
<hr />
<p>Lenguajes y Paradigmas de Programación, curso 2015-16<br />
© Departamento Ciencia de la Computación e Inteligencia Artificial, Universidad de Alicante<br />
Domingo Gallardo, Cristina Pomares</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>