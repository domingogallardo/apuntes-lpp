
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.1.7">
    
    
      
        <title>Ambitos let clousures - LPP</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.ded33207.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="Teal" data-md-color-accent="Teal">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#6-ambitos-de-variables-let-y-closures" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="LPP" class="md-header__button md-logo" aria-label="LPP" data-md-component="logo">
      
  <img src="../../imagenes/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LPP
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Ambitos let clousures
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="LPP" class="md-nav__button md-logo" aria-label="LPP" data-md-component="logo">
      
  <img src="../../imagenes/logo.png" alt="logo">

    </a>
    LPP
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          Teoría
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Teoría
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tema00-descripcion-asignatura/tema00-descripcion-asignatura.html" class="md-nav__link">
        Descripción de la asignatura
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tema01-historia-lenguajes-programacion/tema01-historia-lenguajes-programacion.html" class="md-nav__link">
        Tema 1: Historia de los lenguajes de programación
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tema02-programacion-funcional/tema02-programacion-funcional.html" class="md-nav__link">
        Tema 2: Programación funcional
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Seminarios
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Seminarios
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../seminarios/seminario1-scheme/seminario1-scheme.html" class="md-nav__link">
        Seminario de Scheme
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#6-ambitos-de-variables-let-y-closures" class="md-nav__link">
    6. Ámbitos de variables, let y closures
  </a>
  
    <nav class="md-nav" aria-label="6. Ámbitos de variables, let y closures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-ambitos-de-variables" class="md-nav__link">
     6.1. Ámbitos de variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-forma-especial-let" class="md-nav__link">
     6.2 Forma especial let
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-clausuras" class="md-nav__link">
     6.3. Clausuras
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Ambitos let clousures</h1>

<h2 id="6-ambitos-de-variables-let-y-closures"><a name="6"></a>6. Ámbitos de variables, let y closures<a class="headerlink" href="#6-ambitos-de-variables-let-y-closures" title="Permanent link">&para;</a></h2>
<p>Ahora que hemos introducido la forma especial <code>lambda</code> y la idea de
que una función es un objeto de primera clase, podemos revisar el
concepto de ámbito de variables en Scheme e introducir un importante
concepto: clausura
(<em><a href="https://en.wikipedia.org/wiki/Closure_(computer_programming)">closure</a></em>
en inglés).</p>
<h3 id="61-ambitos-de-variables"><a name="6-1"></a> 6.1. Ámbitos de variables<a class="headerlink" href="#61-ambitos-de-variables" title="Permanent link">&para;</a></h3>
<p>El concepto del <strong>ámbito</strong> de vida de las variables es un concepto
fundamental en los lenguajes de programación. En inglés se utiliza el
término
<em><a href="https://en.wikipedia.org/wiki/Scope_(computer_science)">scope</a></em>.</p>
<p>Cuando se define una variable, asociándole un valor, esta asociación
tiene una extensión determinada, ya sea en términos de tiempo de
compilación (<strong>ámbito léxico</strong>) como en términos de tiempo de
ejecución (<strong>ámbito dinámico</strong>). El ámbito de una variable determina
cuándo podemos referirnos a ella para recuperar el valor asociado.</p>
<p>Al conjunto de variables disponibles en una parte del programa o en
una parte de su ejecución se denomina <strong>contexto</strong> o <strong>entorno</strong>
(<em>context</em> o <em>environment</em>).</p>
<h4 id="variables-de-ambito-global">Variables de ámbito global<a class="headerlink" href="#variables-de-ambito-global" title="Permanent link">&para;</a></h4>
<p>Una variable definida en el programa con la instrucción <code>define</code> tiene
un ámbito global.</p>
<div class="highlight"><pre><span></span><code>(define a &quot;hola&quot;)
(define b (string-append &quot;adios&quot; a))
(define cuadrado (lambda (x) (* x x)))
</code></pre></div>
<p>Todas las variables definidas fuera de funciones forman parte del
<strong>entorno global</strong> del programa.</p>
<h4 id="variables-de-ambito-local">Variables de ámbito local<a class="headerlink" href="#variables-de-ambito-local" title="Permanent link">&para;</a></h4>
<p>Como en la mayoría de lenguajes de programación, en Scheme se crea un
<strong>entorno local</strong> cada vez que se invoca a una función. En este
entorno local los argumentos de la función toman los valores de los
parámetros usados en la llamada a la función. Consideramos, por tanto,
estos parámetros como variables de ámbito local de la función.</p>
<p>Podemos usar en un entorno local una variable con el mismo nombre que
en el entorno global. Cuando se ejecute el código de la función se
evaluará la variable de ámbito local.</p>
<p>Por ejemplo, supongamos las expresiones:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">suma-3</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span>
<span class="w">   </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span>

<span class="p">(</span><span class="nf">suma-3</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span>
<span class="err">⇒</span><span class="w"> </span><span class="mi">15</span>
</code></pre></div>
<p>Cuando se ejecuta la expresión <code>(+ x 3)</code> en la invocación a <code>(suma-3
12)</code> el valor de <code>x</code> es 12, no es 5, devolviéndose 15.</p>
<p>Una vez realizada la invocación, desparece el entorno local y las
variables locales definidas en él, recuperándose el contexto
global. Por ejemplo, en la siguiente expresión, una vez realizada la
invocación a <code>(suma-3 12)</code> se devuelve el número 15 y se evalúa en el
entorno global la expresión <code>(+ 15 x)</code>. En este contexto la variable
<code>x</code> vale 5 por lo que la expresión devuelve 20.</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">suma-3</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span>
<span class="w">   </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span>

<span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="p">(</span><span class="nf">suma-3</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span>
<span class="err">⇒</span><span class="w"> </span><span class="mi">20</span>
</code></pre></div>
<p>En el entorno local también se pueden utilizar variables definidas en
el entorno global. Por ejemplo:</p>
<div class="highlight"><pre><span></span><code>(define y 12)
(define (suma-3-bis x)
   (+ x y 3))

(suma-3-bis 5) 
⇒ 20
</code></pre></div>
<p>La expresión <code>(+ x 3 y)</code> se evalúa en el entorno local en el que <code>x</code>
vale 5. Al no estar definida la variable <code>y</code> en este entorno local, se
usa su definición de ámbito global.</p>
<h3 id="62-forma-especial-let"><a name="6-2"></a> 6.2 Forma especial let<a class="headerlink" href="#62-forma-especial-let" title="Permanent link">&para;</a></h3>
<h4 id="forma-especial-let">Forma especial let<a class="headerlink" href="#forma-especial-let" title="Permanent link">&para;</a></h4>
<p>En Scheme se define la forma especial let que permite crear un entorno
local en el que se da valor a variables y se evalúa una expresión.</p>
<p>Sintaxis:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">&lt;var1&gt;</span><span class="w"> </span><span class="nv">&lt;exp-1&gt;</span><span class="p">)</span>
<span class="w">        </span><span class="o">...</span>
<span class="w">      </span><span class="p">(</span><span class="nf">&lt;varn&gt;</span><span class="w"> </span><span class="nv">&lt;exp-n&gt;</span><span class="p">))</span>
<span class="w">    </span><span class="nv">&lt;cuerpo&gt;</span><span class="p">)</span>
</code></pre></div>
<p>Las variables <code>var1</code>, … <code>varn</code> toman los valores devueltos por las
expresiones <code>exp1</code>, … <code>expn</code> y el cuerpo se evalúa con esos valores.</p>
<p>Por ejemplo:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span>
<span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">x</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nf">y</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nf">z</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span>
<span class="w">    </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="nv">z</span><span class="p">))</span>
<span class="err">⇒</span><span class="w"> </span><span class="mi">6</span>
</code></pre></div>
<h4 id="el-ambito-de-las-variables-definidas-en-el-let-es-local">El ámbito de las variables definidas en el let es local<a class="headerlink" href="#el-ambito-de-las-variables-definidas-en-el-let-es-local" title="Permanent link">&para;</a></h4>
<p>Las variables definidas en el <code>let</code> sólo tienen valores en el entorno
creado por la forma especial.</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span>
<span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">x</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nf">y</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nf">z</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span>
<span class="w">    </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="nv">z</span><span class="p">))</span>
<span class="err">⇒</span><span class="w"> </span><span class="mi">6</span>
</code></pre></div>
<p>Cuando ha terminado la evaluación del <code>let</code> el ámbito local desaparece
y quedan los valores definidos en el ámbito global.</p>
<div class="highlight"><pre><span></span><code><span class="nv">x</span><span class="w"> </span><span class="err">⇒</span><span class="w"> </span><span class="mi">5</span>
<span class="nv">y</span><span class="w"> </span><span class="err">⇒</span><span class="w"> </span><span class="nv">error,</span><span class="w"> </span><span class="nv">no</span><span class="w"> </span><span class="nv">definida</span>
</code></pre></div>
<h4 id="let-permite-usar-variables-definidas-en-un-ambito-en-el-que-se-ejecuta-el-let"><code>Let</code> permite usar variables definidas en un ámbito en el que se ejecuta el <code>let</code><a class="headerlink" href="#let-permite-usar-variables-definidas-en-un-ambito-en-el-que-se-ejecuta-el-let" title="Permanent link">&para;</a></h4>
<p>Al igual que en la invocación a funciones, desde el ámbito definido
por el <code>let</code> se puede usar las variables del entorno en el que se está
ejecutando el <code>let</code>. Por ejemplo, en el siguiente código se usa la
variable z definida en el ámbito global.</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">z</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span>
<span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">x</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nf">y</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span>
<span class="w">   </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="nv">z</span><span class="p">))</span>
<span class="err">⇒</span><span class="w"> </span><span class="mi">11</span>
</code></pre></div>
<h4 id="variables-en-las-definiciones-del-let">Variables en las definiciones del <code>let</code><a class="headerlink" href="#variables-en-las-definiciones-del-let" title="Permanent link">&para;</a></h4>
<p>Las expresiones que dan valor a las variables del <code>let</code> se evalúan
todas en el entorno en el que se ejecuta el <code>let</code>, antes de crear las
variables locales.  No se realiza una asignación secuencial:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">w</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span>
<span class="w">      </span><span class="p">(</span><span class="nf">z</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">w</span><span class="w"> </span><span class="mi">2</span><span class="p">)))</span><span class="w"> </span><span class="c1">;; Error: w no está definida</span>
<span class="w">    </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">w</span><span class="w"> </span><span class="nv">z</span><span class="p">))</span>
</code></pre></div>
<h5 id="semantica-del-let">Semántica del <code>let</code><a class="headerlink" href="#semantica-del-let" title="Permanent link">&para;</a></h5>
<p>Para evaluar una expresión <code>let</code> debemos seguir las siguientes reglas:</p>
<ol>
<li>Evaluar todas las expresiones de la derecha de las variables y
   guardar sus valores en variables auxiliares locales.</li>
<li>Definir un ámbito local en el que se ligan las variables del let
   con los valores de las variables auxiliares.</li>
<li>Evaluar el cuerpo del let en el ámbito local</li>
</ol>
<h5 id="let-se-define-utilizando-lambda">Let se define utilizando lambda<a class="headerlink" href="#let-se-define-utilizando-lambda" title="Permanent link">&para;</a></h5>
<p>La semántica anterior queda clara cuando comprobamos que let se puede
definir en función de lambda. En general, la expresión:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">&lt;var1&gt;</span><span class="w"> </span><span class="nv">&lt;exp1&gt;</span><span class="p">)</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="p">(</span><span class="nf">&lt;varn&gt;</span><span class="w"> </span><span class="nv">&lt;expn&gt;</span><span class="p">))</span><span class="w"> </span><span class="nv">&lt;cuerpo&gt;</span><span class="p">)</span>
</code></pre></div>
<p>se puede implementar con la siguiente llamada a lambda:</p>
<div class="highlight"><pre><span></span><code><span class="p">((</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">&lt;var1&gt;</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="nv">&lt;varn&gt;</span><span class="p">)</span><span class="w"> </span><span class="nv">&lt;cuerpo&gt;</span><span class="p">)</span><span class="w"> </span><span class="nv">&lt;exp1&gt;</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="nv">&lt;expn&gt;</span><span class="p">)</span>
</code></pre></div>
<p>Para ejecutar un <code>let</code> con un <code>lambda</code> se debe crear un procedimiento
en tiempo de ejecución con tantas variables como las variables del
<code>let</code>, con el cuerpo del <code>let</code>, y se debe invocar a dicho
procedimiento con las expresiones de las variables del <code>let</code>. Esas
expresiones se evalúan antes de invocar al procedimiento y la
invocación se realiza con los resultados. La invocación crea un
entorno local con los parámetros del procedimiento (las variables del
<code>let</code>) asociados a los valores, y en este ámbito local se ejecuta el
cuerpo del procedimiento (el cuerpo del <code>let</code>).</p>
<p>Por ejemplo:</p>
<div class="highlight"><pre><span></span><code>(let ((x (+ 2 3))
      (y (+ x 3)))
    (+ x y))
</code></pre></div>
<p>Equivale a:</p>
<div class="highlight"><pre><span></span><code><span class="p">((</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>
<h4 id="let-dentro-de-funciones">Let dentro de funciones<a class="headerlink" href="#let-dentro-de-funciones" title="Permanent link">&para;</a></h4>
<p>Podemos usar <code>let</code> en el cuerpo de funciones para crear nuevas
variables locales, además de los parámetros de la función</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">suma-cuadrados</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">cuadrado-x</span><span class="w"> </span><span class="p">(</span><span class="nf">cuadrado</span><span class="w"> </span><span class="nv">x</span><span class="p">))</span>
<span class="w">          </span><span class="p">(</span><span class="nf">cuadrado-y</span><span class="w"> </span><span class="p">(</span><span class="nf">cuadrado</span><span class="w"> </span><span class="nv">y</span><span class="p">)))</span>
<span class="w">        </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">cuadrado-x</span><span class="w"> </span><span class="nv">cuadrado-y</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">suma-cuadrados</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="err">⇒</span><span class="w"> </span><span class="mi">116</span>
</code></pre></div>
<p>Cuando se invoca <code>(suma-cuadrados 4 10)</code> se crea un entorno local en
el que las variables <code>x</code> e <code>y</code> toman el valor <code>4</code> y <code>10</code> y en el que
se ejecuta la forma especial <code>let</code>. Esta forma especial crea a su vez
un entorno local en el que se definen las variables <code>cuadrado-x</code> y
<code>cuadrado-y</code> que toman los valores devueltos por las expresiones
<code>(cuadrado x)</code> y <code>(cuadrado y)</code>: <code>16</code> y <code>100</code>. En este entorno local
se evalúa la expresión <code>(+ cuadrado-x cuadrado-y)</code>.</p>
<p>El uso de <code>let</code> permite aumentar la legibilidad de los programas,
dando nombre a expresiones:</p>
<p>Por ejemplo:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">distancia</span><span class="w"> </span><span class="nv">x1</span><span class="w"> </span><span class="nv">y1</span><span class="w"> </span><span class="nv">x2</span><span class="w"> </span><span class="nv">y2</span><span class="p">)</span>
<span class="w">   </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">distancia-x</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="nv">x2</span><span class="w"> </span><span class="nv">x1</span><span class="p">))</span>
<span class="w">         </span><span class="p">(</span><span class="nf">distancia-y</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="nv">y2</span><span class="w"> </span><span class="nv">y1</span><span class="p">)))</span>
<span class="w">      </span><span class="p">(</span><span class="nb">sqrt</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="p">(</span><span class="nf">cuadrado</span><span class="w"> </span><span class="nv">distancia-x</span><span class="p">)</span>
<span class="w">               </span><span class="p">(</span><span class="nf">cuadrado</span><span class="w"> </span><span class="nv">distancia-y</span><span class="p">)))))</span>
</code></pre></div>
<p>Otro ejemplo:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">intersecta-intervalo</span><span class="w"> </span><span class="nv">a1</span><span class="w"> </span><span class="nv">a2</span><span class="w"> </span><span class="nv">b1</span><span class="w"> </span><span class="nv">b2</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">dentro-b1</span><span class="w"> </span><span class="p">(</span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;=</span><span class="w"> </span><span class="nv">b1</span><span class="w"> </span><span class="nv">a1</span><span class="p">)</span>
<span class="w">                          </span><span class="p">(</span><span class="nb">&lt;=</span><span class="w"> </span><span class="nv">b1</span><span class="w"> </span><span class="nv">a2</span><span class="p">)))</span>
<span class="w">          </span><span class="p">(</span><span class="nf">dentro-b2</span><span class="w"> </span><span class="p">(</span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;=</span><span class="w"> </span><span class="nv">b2</span><span class="w"> </span><span class="nv">a1</span><span class="p">)</span>
<span class="w">                          </span><span class="p">(</span><span class="nb">&lt;=</span><span class="w"> </span><span class="nv">b2</span><span class="w"> </span><span class="nv">a2</span><span class="p">))))</span>
<span class="w">        </span><span class="p">(</span><span class="k">or</span><span class="w"> </span><span class="nv">dentro-b1</span><span class="w"> </span><span class="nv">dentro-b2</span><span class="p">)))</span>
</code></pre></div>
<h3 id="63-clausuras"><a name="6-3"></a> 6.3. Clausuras<a class="headerlink" href="#63-clausuras" title="Permanent link">&para;</a></h3>
<p>Vamos a terminar explicando el concepto de <em>clausura</em>. Hemos visto que
las funciones son objetos de primera clase de Scheme y que es posible
crear funciones en tiempo de ejecución con la forma especial <code>lambda</code>.</p>
<p>Una clausura es una función devuelta por otra función. La clausura
<strong>captura las variables locales</strong> de la función principal y puede
usarlas en su propio código cuando este se invoque posteriormente.</p>
<p>Veamos un ejemplo. Supongamos que definimos la siguiente función
<code>(make-sumador k)</code> que devuelve otra función.</p>
<div class="highlight"><pre><span></span><code>(define (make-sumador k)
    (lambda (x) (+ x k)))

(define f (make-sumador 10))
(f 2)
⇒ 12
</code></pre></div>
<p>En la función <code>(make-sumador k)</code> se llama a la forma especial lambda
para crear un procedimiento. El procedimiento devuelto es lo que se
denomina <strong>clausura</strong>. En este caso la clausura captura la variable
local <code>k</code> (el parámetro de <code>make-sumador</code>) y usa su valor cuando
posteriormente se invoca. Cuando se invoca a <code>(f 2)</code> se ejecuta la
clausura y se crea un nuevo entorno local en el que <code>x</code> (el parámetro
de la clausura) vale <code>2</code> y en el que se usa la variable <code>k</code> capturada.</p>
<p>En la invocación anterior <code>(f 2)</code>, cuando se ejecuta la expresión <code>(+
x k)</code> las variables tienen los siguientes valores:</p>
<div class="highlight"><pre><span></span><code>x: 2 (variable local de la clausura)
k: 10 (valor capturado del entorno local en el que se creó la clausura
</code></pre></div>
<h4 id="las-variables-locales-creadas-en-un-let-tambien-se-capturan-en-las-clausuras">Las variables locales creadas en un <code>let</code> también se capturan en las clausuras<a class="headerlink" href="#las-variables-locales-creadas-en-un-let-tambien-se-capturan-en-las-clausuras" title="Permanent link">&para;</a></h4>
<p>Veamos el siguiente ejemplo, en el que creamos una función en un
entorno local creado por un <code>let</code>:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">prueba</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">y</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">z</span><span class="p">)</span><span class="w"> </span>
<span class="w">            </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="nv">z</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">h</span><span class="w"> </span><span class="p">(</span><span class="nf">prueba</span><span class="w"> </span><span class="mi">5</span><span class="p">))</span>
<span class="p">(</span><span class="nf">h</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="err">⇒</span><span class="w"> </span><span class="mi">8</span>
</code></pre></div>
<p>Sucede lo siguiente:</p>
<ol>
<li>Se invoca la expresión <code>(prueba 5)</code>. Esto crea un entorno local en
   el que se le da a la variable <code>x</code> (el parámetro de <code>prueba</code>) el
   valor <code>5</code>. En este contexto se ejecuta el <code>let</code>, que crea otro
   entorno local en el que <code>y</code> vale 3. En el contexto del <code>let</code> se
   crea una clausura con la invocación de la expresión lambda <code>(lambda
   (z) (+ x y z))</code>.</li>
<li>La clausura captura las variables locales <code>x</code> e <code>y</code> con sus valores
   5 y 3 y la función <code>prueba</code> la devuelve como resultado de la
   invocación.</li>
<li>La clausura se guarda en la variable <code>h</code>.</li>
<li>
<p>Con la invocación <code>(h 2)</code> se invoca a la clausura, lo que crea un
   entorno local en el que se encuentran las siguientes variables:</p>
<div class="highlight"><pre><span></span><code>z: 2 (parámetro de la clausura)
x: 5 (variable local de la función prueba capturada en el momento de creación de la clausura))
y: 3 (variable local del let capturada en el momento de creación de la clausura)
</code></pre></div>
</li>
<li>
<p>En este contexto se ejecuta la expresión <code>(+ x y z)</code>, que devuelve 10.</p>
</li>
</ol>
<hr />
<p>Lenguajes y Paradigmas de Programación, curso 2015-16<br />
© Departamento Ciencia de la Computación e Inteligencia Artificial, Universidad de Alicante<br />
Domingo Gallardo, Cristina Pomares</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.51198bba.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>